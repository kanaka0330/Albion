<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>あるびんご</title>
<style>
:root {
  --marked-bg: #ffe6f2;
}
body { font-family: 'Segoe UI', sans-serif; background: #f4fafd; text-align: center; }
#bingoCard { display: inline-grid; grid-template-columns: repeat(5, 60px); gap: 6px; margin-top: 20px; padding: 10px; border: 2px dashed #f6a; border-radius: 12px;}
.cell {
  width: 60px; height: 60px; display: flex; justify-content: center; align-items: center;
  border-radius: 12px; border: 2px solid #f6a; background: #fff; font-size: 18px;
}
.cell.marked { background: var(--marked-bg); font-weight: bold; color: #e60073; }
/* FREEマスは常に白（マーク色を上書き） */
.cell.free { background: #fff !important; color: #e60073; }

#gacha { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%);
  background: rgba(255,255,255,0.95); padding: 40px; border-radius: 20px;
  box-shadow: 0 0 30px rgba(255,105,180,0.8); font-size: 60px; font-weight: bold;
  z-index: 1000; animation: popIn 0.5s ease; }
#gacha.hidden { display:none; }
@keyframes popIn {
  from { transform: translate(-50%,-50%) scale(0.5); opacity:0; }
  to { transform: translate(-50%,-50%) scale(1); opacity:1; }
}
.slot {
  display:inline-block; font-size:80px; animation:none; 
}
@keyframes spin {
  0% { transform: rotateX(0deg);}
  100% { transform: rotateX(1080deg);}
}
.spinNow { animation: spin 1.3s ease-out; }
.slot-pop { animation: pop .4s ease; }
@keyframes pop {
  0%{transform:scale(1);color:#000;}
  50%{transform:scale(1.5);color:#e60073;}
  100%{transform:scale(1);color:#000;}
}
</style>
</head>
<body>
<h1>🌸あるびんご🌸</h1>
<div>
  <button onclick="joinGame()">参加する</button>
  <button onclick="resetCard()">リセット</button>
  <label><input type="checkbox" id="hostMode"> 主催者モード（抽選）</label>
</div>
<div id="participants"></div>
<div id="bingoCard"></div>

<!-- ガチャ演出 -->
<div id="gacha" class="hidden">
  <div id="slot" class="slot">??</div>
</div>

<script>
let card = [];
let drawnNumbers = [];
let playerName = "かなか";

// カード生成
function generateCard(){
  card=[];
  for(let col=0; col<5; col++){
    let colNums=[];
    while(colNums.length<5){
      let min=col*15+1, max=col*15+15;
      let n=Math.floor(Math.random()*(max-min+1))+min;
      if(!colNums.includes(n)) colNums.push(n);
    }
    card.push(colNums);
  }
  card[2][2]="FREE";
}

// 表示
function displayCard(){
  const cont=document.getElementById("bingoCard");
  cont.innerHTML="";
  for(let r=0;r<5;r++){
    for(let c=0;c<5;c++){
      const cell=document.createElement("div");
      cell.className="cell";
      let n=card[c][r];
      cell.textContent=n;
      if(n==="FREE") cell.classList.add("marked","free");
      if(drawnNumbers.includes(n)) cell.classList.add("marked");
      cont.appendChild(cell);
    }
  }
}

// ガチャ演出
function showGacha(number){
  const g=document.getElementById("gacha");
  const s=document.getElementById("slot");
  g.classList.remove("hidden");
  s.textContent="??";
  triggerSpin(s);
  setTimeout(()=>{ s.textContent=number; s.classList.add("slot-pop"); },1300);
  setTimeout(()=> g.classList.add("hidden"),2800);
}

function triggerSpin(el){
  el.classList.remove("spinNow");
  void el.offsetWidth; // reflow
  el.classList.add("spinNow");
}

// 抽選
function drawNumber(){
  let num;
  do{ num=Math.floor(Math.random()*75)+1; }while(drawnNumbers.includes(num));
  drawnNumbers.push(num);
  showGacha(num);
  displayCard();
}

// 参加（簡易）
function joinGame(){
  generateCard();
  displayCard();
}

// リセット
function resetCard(){
  drawnNumbers=[];
  generateCard();
  displayCard();
}

generateCard();
displayCard();
</script>
</body>
</html>
